from model_wrapper import Model_Factory
import os
import pandas as pd
from tqdm import tqdm
import concurrent.futures
import threading




model = \
Model_Factory.create_model('chatgpt',
                           key='API_KEY',
                           model_name="gpt-3.5-turbo-16k-0613")
# model = Model_Factory.create_model('dummy')

'''
test_news = r"""
(reuters) - wall street securities analysts revised their ratings and price targets on several u.s.-listed companies, including anaplan, natwest group and workday, on tuesday. highlights * anaplan inc <plan.n>: barclays raises to overweight from equal weight * cable one inc <cabo.n>: jp morgan raises to neutral from underweight * epam systems inc <epam.n>: jefferies raises to buy from hold * natwest group plc <nwg.n>: cfra raises to hold from sell * workday inc <wday.o>: barclays raises to overweight from equal weight following is a summary of research actions on u.s. companies reported by reuters on tuesday. stock entries are in alphabetical order. * acadia healthcare company inc <achc.o>: jefferies raises target price to $85 from $75 * actinium pharmaceuticals inc <atnm.a>: h.c. wainwright cuts pt to $45 from $57 * advansix inc <asix.n>: stifel raises target price to $46 from $42 * affirm holdings inc <afrm.o>: d.a. davidson cuts price target to $65 * affirm holdings inc <afrm.o>: d.a. davidson cuts to neutral from buy * alector inc <alec.o>: goldman sachs raises target price to $33 from $29 * alliance data systems corp <ads.n>: evercore isi cuts target price to $103 from $110 * alliance data systems corp <ads.n>: ubs cuts target price to $132 from $143 * alnylam pharmaceuticals inc <alny.o>: cfra raises target price to $175 from $158 * ameresco inc <amrc.n>: oppenheimer raises target price to $72 from $66 * ameresco inc <amrc.n>: stifel raises target price to $72 from $68 * ameriprise financial inc <amp.n>: credit suisse raises target price to $302 from $280 * amphenol corp <aph.n>: cowen and company raises target price to $80 from $75 * anaplan inc <plan.n>: barclays raises target price to $70 from $59 * anaplan inc <plan.n>: barclays raises to overweight from equal weight * apartment income reit corp <airc.n>: citigroup raises price target to $52 from $48 * aptargroup inc <atr.n>: wells fargo cuts price target to $162 from $165 * arcbest corp <arcb.o>: cowen and company raises target price to $99 from $93 * arcbest corp <arcb.o>: truist securities raises target price to $75 from $70 * ares capital corp <arcc.o>: truist securities raises target price to $21 from $20 * ares management corp <ares.n>: rbc raises target price to $80 from $71 * argo group international holdings ltd <argo.n>: compass point raises pt to $68 from $61 * arista networks inc <anet.n>: citigroup raises price target to $400 from $325 * arista networks inc <anet.n>: cowen and company raises target price to $433 from $385 * arista networks inc <anet.n>: credit suisse raises target price to $410 from $362 * arista networks inc <anet.n>: evercore isi raises target price to $420 from $400 * arista networks inc <anet.n>: jefferies raises target price to $365 from $300 * arista networks inc <anet.n>: piper sandler raises target price to $379 from $330 * arista networks inc <anet.n>: stifel raises target price to $350 from $315 * arista networks inc <anet.n>: ubs raises target price to $420 from $370 * arista networks inc <anet.n>: wells fargo raises price target to $375 from $340 * ascendant digital acquisition <mktw.o>: oppenheimer initiates with outperform rating * ascendant digital acquisition <mktw.o>: oppenheimer initiates with price target of $19 * avalonbay communities inc <avb.n>: citigroup raises price target to $230 from $215 * avalonbay communities inc <avb.n>: piper sandler raises target price to $243 from $220 * avantor inc <avtr.n>: guggenheim raises target price to $42 from $37 * avery dennison corp <avy.n>: bmo raises target price to $249 from $241 * avient corp <avnt.n>: citigroup raises price target to $60 from $59 * axalta coating systems ltd <axta.n>: berenberg raises target price to $38 from $37 * bancorpsouth bank <bxs.n>: d.a. davidson cuts target price by $3 to $31 * bank of america corp <bac.n>: jp morgan cuts target price to $43 from $43.50 * bank7 corp <bsvn.o>: piper sandler raises target price to $24 from $21 * baxter international inc <bax.n>: goldman sachs cuts target price to $80 from $93 * bellring brands inc <brbr.n>: credit suisse raises target price to $31 from $26 * biohaven pharmaceutical holding company <bhvn.n>: canaccord genuity ups pt to $150 from $101 * blackrock tcp capital corp <tcpc.o>: wells fargo raises price target to $14.5 from $14 * bloomin' brands inc <blmn.o>: credit suisse raises target price to $33 from $32 * bloomin' brands inc <blmn.o>: credit suisse raises to outperform from neutral * bonanza creek energy inc <bcei.n>: truist securities cuts target price to $60 from $64 * brixmor property group inc <brx.n>: stifel raises target price to $23.25 from $21.5 * bruker corp <brkr.o>: citigroup raises price target to $85 from $75 * bruker corp <brkr.o>: jefferies raises target price to $95 from $84 * bruker corp <brkr.o>: jp morgan raises target price to $75 from $60 * bruker corp <brkr.o>: stifel raises target price to $85 from $70 * bruker corp <brkr.o>: wells fargo raises price target to $85 from $70 * bwx technologies inc <bwxt.n>: credit suisse cuts target price to $65 from $67 * cable one inc <cabo.n>: jp morgan raises target price to $2,100 from $1,800 * cable one inc <cabo.n>: jp morgan raises to neutral from underweight * camden property trust <cpt.n>: citigroup raises price target to $150 from $135 * capri holdings ltd <cpri.n>: cfra raises target price by $9 to $64 * cara therapeutics <cara.o>: jp morgan initiates coverage with neutral rating; pt of $16 * centene corp <cnc.n>: wells fargo cuts price target to $88 from $93 * ceragon networks ltd <crnt.o>: needham raises target price to $5.25 from $4.75 * cerner corp <cern.o>: cfra raises target price to $90 * charter communications inc <chtr.o>: td securities raises target price to $840 from $800 * chemours co <cc.n>: bmo raises target price to $50 from $48 * chemours co <cc.n>: citigroup raises price target to $36 from $35 * chemours co <cc.n>: rbc raises target price to $40 from $35 * citigroup inc <c.n>: jp morgan cuts target price to $76 from $77.50 * clarus corp <clar.o>: d.a. davidson raises price target to $36 from $31 * clarus corp <clar.o>: jefferies raises target price to $37 from $30 * clarus corp <clar.o>: stifel raises target price to $35 from $27 * clear channel outdoor holdings <cco.n>: citigroup raises price target to $2.75 from $2.5 * clear secure inc <you.n>: jp morgan cuts to neutral from overweight * columbia sportswear co <colm.o>: cowen and company raises target price to $135 from $133 * columbus mckinnon corp <cmco.o>: colliers securities raises pt to $64 from $61 * consolidated communications holdings inc <cnsl.o>: citigroup raises to neutral from sell * continental resources inc <clr.n>: credit suisse raises target price to $38 from $37 * core laboratories nv <clb.n>: citigroup cuts price target to $28 from $36 * corvus pharmaceuticals inc <crvs.o>: mizuho cuts target price to $3.50 from $4 * cto realty growth inc <cto.n>: compass point raises target price to $60 from $55 * customers bancorp inc <cubi.n>: d.a. davidson raises target price to $40 from $39 * cymabay therapeutics inc <cbay.o>: h.c. wainwright cuts price target to $12 from $13 * denny's corp <denn.o>: mkm partners cuts fair value to $16.50 from $18 * digital realty trust inc <dlr.n>: deutsche bank raises price target to $175 from $167 * dine brands global inc <din.n>: mkm partners cuts fair value to $94 from $97 * dsp group inc <dspg.o>: cowen and company raises target price to $24 from $23 * duke realty corp <dre.n>: rbc raises target price to $55 from $49 * dxc technology co <dxc.n>: bmo raises target price to $50 from $43 * dxc technology co <dxc.n>: bmo raises to outperform from market perform * eastgroup properties inc <egp.n>: rbc raises target price to $177 from $163 * eastman chemical co <emn.n>: ubs raises target price to $136 from $133 * edwards lifesciences corp <ew.n>: goldman sachs raises target price to $105 from $93 * eldorado gold corp <ego.n>: scotiabank cuts target price to $15 from $16.5 * endeavor group holdings inc <edr.n>: citigroup cuts price target to $29 from $34 * enviva partners lp <eva.n>: citigroup raises price target to $55 from $52 * epam systems inc <epam.n>: jefferies raises target price to $670 from $455 * epam systems inc <epam.n>: jefferies raises to buy from hold * essex property trust inc <ess.n>: citigroup raises price target to $320 from $300 * establishment labs holdings inc <esta.o>: goldman sachs raises pt to $78 from $68 * everquote inc <ever.o>: needham cuts target price to $45 from $65 * everquote inc <ever.o>: oppenheimer cuts target price to $45 from $55 * fedex corp <fdx.n>: credit suisse assumes coverage with outperform rating and pt of $373 * fidelity national information services <fis.n>: evercore isi raises pt to $183 from $182 * first community corp (south carolina) <fcco.o>: d.a. davidson raises pt by $1.50 to $24 * first industrial realty trust inc <fr.n>: rbc raises target price to $63 from $58 * first of long island corp <flic.o>: piper sandler cuts target price to $23.50 from $24.50 * first solar inc <fslr.o>: bofa global research raises price objective to $113 from $111 * first solar inc <fslr.o>: guggenheim initiates coverage with buy rating and $113 pt * foot locker inc <fl.n>: piper sandler raises target price to $48 from $37 * fortive corp <ftv.n>: berenberg raises target price to $89 from $88 * freshpet inc <frpt.o>: credit suisse cuts target price to $170 from $180 * freshpet inc <frpt.o>: jefferies cuts target price to $190 from $212 * freshpet inc <frpt.o>: truist securities cuts target price to $145 from $175 * global payments inc <gpn.n>: bofa global research raises price objective to $226 from $221 * global payments inc <gpn.n>: cowen and company cuts target price to $233 from $251 * global payments inc <gpn.n>: jp morgan cuts target price to $220 from $232 * global payments inc <gpn.n>: rosenblatt securities raises target price to $243 from $240 * globant sa <glob.n>: jefferies raises target price to $290 from $235 * globant sa <glob.n>: jefferies raises to buy from hold * green plains inc <gpre.o>: bmo raises target price to $43 from $36 * green plains inc <gpre.o>: craig-hallum raises target price to $46 from $39 * green plains inc <gpre.o>: goldman sachs raises target price to $43 from $39 * green plains inc <gpre.o>: jefferies raises target price to $45 from $36 * green plains partners lp <gpp.o>: stifel raises target price to $16 from $13 * green plains partners lp <gpp.o>: stifel raises to buy from hold * greensky inc <gsky.o>: truist securities raises target price to $8 from $7 * griffon corp <gff.n>: truist securities cuts target price to $27 from $32 * gxo logistics inc <gxo.n>: truist securities initiates coverage with buy rating; pt $100 * harmonic inc <hlit.o>: colliers securities raises target price to $15 from $11 * harmonic inc <hlit.o>: jefferies raises target price to $9 from $7.5 * harmonic inc <hlit.o>: needham raises target price to $13 from $9.50 * harmonic inc <hlit.o>: stifel raises target price to $11 from $10 * helmerich and payne inc <hp.n>: citigroup cuts price target to $31 from $33 * hollysys automation technologies <holi.o>: jp morgan raises target price to $24 from $15 * hollysys automation technologies <holi.o>: jp morgan raises to overweight from neutral * honeywell international inc <hon.o>: ubs raises target price to $230 from $220 * hub group inc <hubg.o>: stifel raises target price to $76 from $73 * hubspot inc <hubs.n>: jefferies raises target price to $690 from $600 * hut 8 mining corp <hut.o>: craig-hallum initiates with buy rating and $10 price target * hutchmed (china) ltd <hcm.o>: jefferies initiates coverage with buy rating; pt $52 * idexx laboratories inc <idxx.o>: goldman sachs raises target price to $610 from $550 * immunogen inc <imgn.o>: jefferies cuts target price to $7 from $8 * immunovant inc <imvt.o>: baird cuts to neutral rating; cuts target price to $10 from $20 * immunovant inc <imvt.o>: credit suisse cuts target price to $7 from $12 * immunovant inc <imvt.o>: credit suisse cuts to underperform from neutral * incyte corp <incy.o>: cfra cuts target price by $8 to $87 * incyte corp <incy.o>: evercore isi cuts target price to $105 from $115 * industrial logistics properties trust <ilpt.o>: rbc raises target price to $28 from $26 * ingersoll rand inc <ir.n>: ubs raises target price to $63 from $61 * ingevity corp <ngvt.n>: bmo raises target price to $115 from $112 * insperity inc <nsp.n>: truist securities raises target price to $125 from $115 * intercept pharmaceuticals inc <icpt.o>: canaccord genuity cuts pt to $31 from $43 * intercontinental exchange inc <ice.n>: jp morgan raises target price to $139 from $137 * intrepid potash inc <ipi.n>: ubs raises target price to $21 from $20 * investar holding corp <istr.o>: d.a. davidson raises price target to $25.25 * invitation homes inc <invh.n>: citigroup raises price target to $46.5 from $39 * invitation homes inc <invh.n>: evercore isi raises target price to $43 from $42 * jeld-wen holding inc <jeld.n>: jefferies raises target price to $29 from $28 * jeld-wen holding inc <jeld.n>: jp morgan cuts target price to $31.5 from $34.5 * jeld-wen holding inc <jeld.n>: rbc raises target price to $30 from $29 * kinder morgan inc <kmi.n>: stifel raises target price to $19 from $18 * knowbe4 inc <knbe.o>: berenberg raises target price to $27 from $24 * liberty oilfield services inc <lbrt.n>: citigroup cuts price target to $12 from $13.5 * liberty oilfield services inc <lbrt.n>: goldman sachs cuts target price to $13 from $17 * lightspeed pos inc <lspd.n>: bmo raises target price to $100 from $87 * limelight networks inc <llnw.o>: goldman sachs cuts target price to $2.25 from $2.5 * lindblad expeditions holdings <lind.o>: craig-hallum raises target price to $20 from $17 * linde plc <lin.n>: bmo raises target price to $355 from $351 * linde plc <lin.n>: citigroup raises price target to $372 from $358 * linde plc <lin.n>: wells fargo raises price target to $360 from $340 * lyondellbasell industries nv <lyb.n>: citigroup cuts price target to $111 from $112 * mack-cali realty corp <cli.n>: evercore isi raises target price to $18 from $17 * magenta therapeutics inc <mgta.o>: jp morgan cuts target price to $7 from $16 * magenta therapeutics inc <mgta.o>: jp morgan cuts to neutral from overweight * match group inc <mtch.o>: jefferies raises target price to $185 from $175 * mdc holdings inc <mdc.n>: jp morgan raises target price to $80 from $79 * mercadolibre inc <meli.o>: credit suisse raises target price to $2050 from $1824 * mercer international inc <merc.o>: td securities cuts target price to $13.50 from $14.50 * mid-america apartment communities <maa.n>: citigroup raises price target to $190 from $170 * molina healthcare inc <moh.n>: wells fargo raises price target to $256 from $253 * mr cooper group inc <coop.o>: credit suisse raises target price to $46 from $45 * mr cooper group inc <coop.o>: piper sandler raises target price to $48 from $45 * msci inc <msci.n>: deutsche bank raises price target to $650 from $600 * nabors industries ltd <nbr.n>: atb capital markets raises target price to $91 from $89 * nabors industries ltd <nbr.n>: citigroup cuts price target to $65 from $80 * natwest group plc <nwg.n>: cfra raises target price to $6 from $4.50 * natwest group plc <nwg.n>: cfra raises to hold from sell * navsight holdings, inc. <nsh.n>: benchmark cuts target price to $20 from $22 * nextgen healthcare inc <nxgn.o>: jefferies cuts target price to $17 from $19 * northfield bancorp inc <nfbk.o>: piper sandler cuts target price to $18 from $19 * nvidia corp <nvda.o>: bofa global research raises price objective to $250 from $225 * nvidia corp <nvda.o>: jp morgan raises price target to $215 from $176 * oceaneering international inc <oii.n>: citigroup cuts price target to $17 from $18 * old dominion freight line inc <odfl.o>: goldman sachs cuts to neutral from buy * omega healthcare investors inc <ohi.n>: berenberg cuts target price to $39 from $40 * on semiconductor corp <on.o>: benchmark assumes coverage with buy rating; pt $53 vs $45 * on semiconductor corp <on.o>: bmo raises target price to $45 from $40 * on semiconductor corp <on.o>: bofa global research raises price objective to $55 from $48 * on semiconductor corp <on.o>: cfra raises target price to $50 from $41 * on semiconductor corp <on.o>: citigroup raises price target to $54 from $45 * on semiconductor corp <on.o>: cowen and company raises target price to $58 from $44 * on semiconductor corp <on.o>: craig-hallum raises target price to $52 from $45 * on semiconductor corp <on.o>: credit suisse raises target price to $45 from $17 * on semiconductor corp <on.o>: deutsche bank raises price target to $52 from $45 * on semiconductor corp <on.o>: jefferies raises target price to $51 from $45 * on semiconductor corp <on.o>: jp morgan raises target price to $50 from $44 * on semiconductor corp <on.o>: mizuho raises price target to $49 from $44 * on semiconductor corp <on.o>: morgan stanley raises price target to $42 from $32 * on semiconductor corp <on.o>: morgan stanley raises to equal-weight from underweight * on semiconductor corp <on.o>: needham raises target price to $60 from $55 * on semiconductor corp <on.o>: piper sandler raises target price to $56 from $45 * on semiconductor corp <on.o>: rosenblatt securities raises target price to $60 from $44 * on semiconductor corp <on.o>: susquehanna raises target price to $57 from $48 * on semiconductor corp <on.o>: truist securities raises target price to $51 from $46 * outlook therapeutics inc <otlk.o>: h.c. wainwright raises price target to $6 from $5 * ovintiv inc <ovv.n>: citigroup cuts price target to $41 from $44 * owens & minor inc <omi.n>: cfra cuts price target by $8 to $44 * p&g <pg.n>: berenberg raises target price to $162 from $150 * papa john's international inc <pzza.o>: btig raises target price to $135 from $115 * papa john's international inc <pzza.o>: mkm partners cuts fair value to $110 from $113 * patterson-uti energy inc <pten.o>: citigroup cuts price target to $9 from $10 * patterson-uti energy inc <pten.o>: evercore isi raises price target to $13 from $12 * payoneer global inc <payo.o>: william blair starts with outperform rating * planet fitness inc <plnt.n>: stifel raises target price to $85 from $82 * planet fitness inc <plnt.n>: stifel raises to buy from hold * processa pharmaceuticals <pcsa.o>: oppenheimer initiates with outperform rating; pt of $20 * professional holding corp <pfhd.o>: piper sandler cuts to neutral from overweight * prologis inc <pld.n>: rbc raises target price to $144 from $130 * proto labs inc <prlb.n>: berenberg cuts target price to $87 from $90 * ramaco resources inc <metc.o>: jefferies raises target price to $7.50 from $5.50 * rambus inc <rmbs.o>: credit suisse raises target price to $22.50 from $19 * rambus inc <rmbs.o>: deutsche bank raises price target to $26 from $25 * rambus inc <rmbs.o>: jefferies raises target price to $23 from $20 * rambus inc <rmbs.o>: susquehanna raises target price to $32 from $30 * rambus inc <rmbs.o>: wells fargo raises price target to $27 from $24 * raymond james financial inc <rjf.n>: citigroup cuts price target to $205 from $215 * realty income corp <o.n>: berenberg raises target price to $78 from $75 * realty income corp <o.n>: stifel raises target price to $76 from $74.5 * relx <relx.n>: cfra raises target price by $2 to $28 * republic services inc <rsg.n>: jefferies raises target price to $137 from $127 * restaurant brands international inc <qsr.n>: cibc raises target price to $78 from $77 * restaurant brands international inc <qsr.n>: rbc raises target price to $80 from $73 * rexford industrial realty inc <rexr.n>: citigroup raises price target to $69.5 from $60 * reynolds consumer products inc <reyn.o>: citigroup cuts price target to $32 from $35 * reynolds consumer products inc <reyn.o>: credit suisse cuts target price to $35 from $36 * reynolds consumer products inc <reyn.o>: jp morgan cuts target price to $33 from $34 * reynolds consumer products inc <reyn.o>: rbc cuts target price to $33 from $35 * reynolds consumer products inc <reyn.o>: stifel cuts target price to $31 from $35 * sba communications corp <sbac.o>: cowen and company raises target price to $347 from $337 * sba communications corp <sbac.o>: credit suisse raises target price to $325 from $312 * sba communications corp <sbac.o>: jp morgan raises target price to $354 from $300 * sba communications corp <sbac.o>: truist securities raises pt to $400 from $335 * sba communications corp <sbac.o>: ubs raises target price to $380 from $355 * sba communications corp <sbac.o>: wells fargo raises price target to $375 from $350 * seres therapeutics inc <mcrb.o>: jefferies cuts price target to $19 from $21 * si-bone inc <sibn.o>: needham cuts target price to $37 from $42 * silicon laboratories inc <slab.o>: citigroup raises price target to $155 from $135 * simon property group inc <spg.n>: deutsche bank raises price target to $160 from $142 * simon property group inc <spg.n>: evercore isi raises target price to $141 from $137 * simon property group inc <spg.n>: stifel raises target price to $137 from $132 * simon property group inc <spg.n>: ubs raises target price to $139 from $135 * sitime corp <sitm.o>: stifel raises target price to $145 from $140 * sjw group <sjw.n>: jp morgan raises target price to $73 from $67 * skillsoft corp <skil.n>: barclays initiates coverage with overweight rating; pt $12 * solaredge technologies inc <sedg.o>: credit suisse raises target price to $342 from $322 * solaredge technologies inc <sedg.o>: goldman sachs raises pt to $368 from $322 * solaredge technologies inc <sedg.o>: piper sandler raises target price to $351 from $342 * solaredge technologies inc <sedg.o>: truist securities raises pt to $340 from $325 * solaredge technologies inc <sedg.o>: tudor pickering holt raises pt to $340 from $327 * solaredge technologies inc <sedg.o>: ubs raises target price to $230 from $220 * solaris oilfield infrastructure inc <soi.n>: citigroup cuts price target to $9 from $10 * square inc <sq.n>: bmo raises target price to $259 from $225 * square inc <sq.n>: btig raises target price to $320 from $295 * square inc <sq.n>: canaccord genuity raises target price to $310 from $280 * square inc <sq.n>: cfra raises target price to $300 * square inc <sq.n>: compass point raises target price to $270 * square inc <sq.n>: cowen and company raises target price to $343 from $266 * square inc <sq.n>: cowen and company raises to outperform from market perform * square inc <sq.n>: guggenheim raises target price to $320 from $308 * square inc <sq.n>: jefferies raises target price to $265 from $245 * square inc <sq.n>: needham raises target price to $350 from $310 * square inc <sq.n>: piper sandler raises target price to $290 from $250 * square inc <sq.n>: rbc raises target price to $312 from $305 * square inc <sq.n>: rosenblatt securities raises target price to $335 from $330 * square inc <sq.n>: truist securities raises target price to $365 from $325 * stag industrial inc <stag.n>: citigroup raises price target to $44 from $37.5 * stag industrial inc <stag.n>: rbc raises target price to $46 from $42 * stmicroelectronics nv <stm.n>: cfra raises target price to $54 from $46 * taboola.com <tbla.o>: oppenheimer initiates coverage with outperform rating; pt of $14 * tactile systems technology inc <tcmd.o>: btig raises target price to $73 from $69 * take-two interactive software <ttwo.o>: credit suisse cuts target price to $210 from $211 * take-two interactive software <ttwo.o>: mkm partners cuts fair value to $180 from $185 * take-two interactive software <ttwo.o>: wedbush raises pt to $222 from $212.50 * take-two interactive software inc <ttwo.o>: oppenheimer cuts pt to $215 from $230 * telus international cda inc <tixt.n>: cibc raises target price to $39.5 from $37 * telus international cda inc <tixt.n>: scotiabank raises target price to $40 from $39 * tg therapeutics inc <tgtx.o>: evercore isi cuts target price to $55 from $80 * tg therapeutics inc <tgtx.o>: h.c. wainwright cuts target price to $84 from $89 * tg therapeutics inc <tgtx.o>: jefferies cuts target price to $57 from $65 * tg therapeutics inc <tgtx.o>: jp morgan cuts target price to $59 from $67 * tower semiconductor ltd <tsem.o>: jefferies raises target price to $34 from $32 * tpg re finance trust inc <trtx.n>: jp morgan raises target price to $13.50 from $12.50 * tractor supply co <tsco.o>: benchmark starts with buy rating; price target $219 * translate bio inc <tbio.o>: jefferies cuts to hold from buy * translate bio inc <tbio.o>: jefferies raises price target to $38 from $25 * translate bio inc <tbio.o>: svb leerink raises price target to $38 from $19 * translate bio inc <tbio.o>: truist securities raises target price to $38 from $20 * trex company inc <trex.n>: d.a. davidson cuts target price to $100 from $108 * trico bancshares <tcbk.o>: piper sandler raises to overweight from neutral * tronox holdings plc <trox.n>: jp morgan cuts target price to $26 from $29 * truist financial corp <tfc.n>: jp morgan cuts target price to $62 from $63 * trustmark corp <trmk.o>: hovde group cuts target price to $32 from $34 * udr inc <udr.n>: citigroup raises price target to $55 from $50 * ultra clean holdings inc <uctt.o>: stifel raises target price to $74 from $71 * ultragenyx pharmaceutical inc <rare.o>: jp morgan cuts target price to $132 from $147 * ultragenyx pharmaceutical inc <rare.o>: stifel cuts target price to $176 from $179 * ultragenyx pharmaceutical inc <rare.o>: wedbush cuts target price to $91 from $106 * union pacific <unp.n>: credit suisse assumes coverage with outperform rating; pt of $264 * ups <ups.n>: credit suisse assumes coverage with outperform rating; target price of $240 * upwork inc <upwk.o>: citigroup raises price target to $72 from $68 * us bancorp <usb.n>: jp morgan raises target price to $65 from $64.50 * us ecology inc <ecol.o>: bmo cuts target price to $40 from $42 * us silica holdings inc <slca.n>: citigroup cuts price target to $12.25 from $13.5 * varonis systems inc <vrns.o>: jp morgan raises price target to $82 from $80 * varonis systems inc <vrns.o>: rbc raises target price to $78 from $75 * varonis systems inc <vrns.o>: wedbush raises target price to $80 from $70 * wells fargo & co <wfc.n>: jp morgan raises target price to $48.50 from $47.50 * welltower inc <well.n>: berenberg raises price target to $100 from $74 * welltower inc <well.n>: berenberg raises to buy from hold * welltower inc <well.n>: evercore isi raises target price to $92 from $90 * wesbanco inc <wsbc.o>: hovde group cuts target price to $38 from $42 * woodward inc <wwd.o>: credit suisse cuts target price to $138 from $151 * woodward inc <wwd.o>: truist securities cuts target price to $110 from $118 * workday inc <wday.o>: barclays raises target price to $282 from $268 * workday inc <wday.o>: barclays raises to overweight from equal weight * xcel energy inc <xel.o>: ubs cuts target price to $68 from $69 * xerox holdings corp <xrx.n>: jp morgan raises target price to $24 from $19 * xpo logistics inc <xpo.n>: goldman sachs cuts target price to $103 from $151 * xpo logistics inc <xpo.n>: goldman sachs raises to buy from neutral * yeti holdings inc <yeti.n>: piper sandler raises target price to $112 from $104 * zoominfo technologies inc <zi.o>: barclays raises target price to $66 from $59 * zoominfo technologies inc <zi.o>: canaccord genuity raises target price to $70 from $65 * zoominfo technologies inc <zi.o>: deutsche bank raises price target to $60 from $54 * zoominfo technologies inc <zi.o>: goldman sachs raises target price to $74 from $65 * zoominfo technologies inc <zi.o>: jp morgan raises target price to $63 from $60 * zoominfo technologies inc <zi.o>: mizuho raises price target to $70 from $63 * zoominfo technologies inc <zi.o>: rbc raises target price to $70 from $60 * zoominfo technologies inc <zi.o>: stifel raises target price to $70 from $65 * zoominfo technologies inc <zi.o>: truist securities raises target price to $80 from $70 * zoominfo technologies inc <zi.o>: wells fargo raises price target to $76 from $64 (compiled by bengaluru newsroom) ((<email>))
    """
    
print(model.summarize(test_news))
exit()
'''
summary = model.summarize
def process_row(row, lock, df, df_name):
    # Perform summary on the 'body' column for news and 'content' column for 10k10q
    result = summary(row['body'])

    # Acquire lock before updating the dataframe and saving to CSV
    with lock:
        # Update the 'summary' column
        df.at[row.name, 'summary'] = result

        # Save the dataframe to CSV
        df.to_csv(os.path.join(TEMP_PATH, df_name), index=False)
        print("saving")

    # Release the lock after updating and saving
    lock.release()

# Function to parallelize the summary tasks using threads
def parallel_summary(df, df_name):
    lock = threading.Lock()
    df_copy = df.copy()
    with concurrent.futures.ThreadPoolExecutor() as executor:
        # Submit each row's summary task to the thread pool
        futures = [executor.submit(process_row, row, lock, df_copy, df_name) for _, row in df.iterrows()]

        # Wait for all tasks to complete
        concurrent.futures.wait(futures)
    return df_copy


SOURCE_PATH = "/home/hfsladmin/Projects/finmem/Cleaaned_Data"
DEST_PATH = "/home/hfsladmin/Projects/finmem/add_summary_data"
TEMP_PATH = "/home/hfsladmin/Projects/finmem/add_summary_data_tmp"


def process_main(file):
    if file.endswith('.csv'):
        print(f"Processing: {file}")
        df = pd.read_csv(os.path.join(SOURCE_PATH, file))
        df["summary"] = None
        ret = parallel_summary(df, file)
        ret.to_csv(os.path.join(DEST_PATH, file))
        print(f"New DF dumpped to {os.path.join(DEST_PATH, file)}")


file_ls = ['cleaned_DIS2021-08-01-2023-05-30.csv',
           'cleaned_MRNA2021-08-01-2023-05-30.csv',
           'cleaned_PFE2021-08-01-2023-05-30.csv',
           'cleaned_NVDA2021-08-01-2023-05-30.csv',
           'cleaned_GM2021-08-01-2023-05-30.csv','cleaned_BAC2021-08-01-2023-05-30.csv',
           'cleaned_CVX2021-08-01-2023-05-30.csv','cleaned_XOM2021-08-01-2023-05-30.csv','cleaned_WMT2021-08-01-2023-05-30.csv','cleaned_JPM2021-08-01-2023-05-30.csv','cleaned_MS2021-08-01-2023-05-30.csv','cleaned_JNJ2021-08-01-2023-05-30.csv','cleaned_MRK2021-08-01-2023-05-30.csv','cleaned_F2021-08-01-2023-05-30.csv','cleaned_C2021-08-01-2023-05-30.csv','cleaned_GS2021-08-01-2023-05-30.csv']

for file in file_ls:
    process_main(file)